Adobe Flash Player BitmapData applyFilter Method HeapOverFlow

Submitter Name : instruder

1 Affected Products
=================
Test Version£º
IE8+Flash 17.0.0.169 + hpa

2 Vulnerability Details
====================

When Flash Player Play Call applyFilter Func,BlurFilter.quality>0x80000000,It Memset and Copy Buffer with a cycle .After a cycle,the dst buf will add a offset

This offset is calc by the rect.x arg. if Offset is big,will overflow.
 

3 Analysis
=========
asm in Flash32_17_0_0_169.ocx


.text:10077CE0 loc_10077CE0:                           ; CODE XREF: sub_10077B20+1D3j
.text:10077CE0                 test    edx, edx
.text:10077CE2                 jz      short loc_10077CEC
.text:10077CE4                 mov     ecx, edx
.text:10077CE6                 mov     eax, ebx
.text:10077CE8                 mov     edi, esi
.text:10077CEA                 rep stosd
.text:10077CEC
.text:10077CEC loc_10077CEC:                           ; CODE XREF: sub_10077B20+1C2j
.text:10077CEC                 add     esi, [esp+34h+distance]
.text:10077CF0                 sub     ebp, 1
.text:10077CF3                 jnz     short loc_10077CE0
.text:10077CF5                 mov     ebp, [esp+34h+arg_0]





4 Exploitable?
============
crashed


5 Crash info:
===============
0:016> g
ModLoad: 63380000 63434000   C:\WINDOWS\system32\jscript.dll
ModLoad: 07fc0000 090e3000   C:\WINDOWS\system32\Macromed\Flash\Flash32_17_0_0_169.ocx
ModLoad: 73e70000 73ecc000   C:\WINDOWS\system32\DSOUND.dll
ModLoad: 762f0000 762f5000   C:\WINDOWS\system32\MSIMG32.dll
ModLoad: 6d180000 6d1b6000   C:\WINDOWS\system32\DINPUT8.dll
ModLoad: 73aa0000 73ab5000   C:\WINDOWS\system32\mscms.dll
ModLoad: 72f70000 72f96000   C:\WINDOWS\system32\WINSPOOL.DRV
ModLoad: 76d30000 76d48000   C:\WINDOWS\system32\IPHLPAPI.DLL
ModLoad: 767c0000 767e7000   C:\WINDOWS\system32\schannel.dll
ModLoad: 5fdd0000 5fe25000   C:\WINDOWS\system32\NETAPI32.dll
ModLoad: 759d0000 75a7f000   C:\WINDOWS\system32\USERENV.dll
ModLoad: 6d7c0000 6d7ca000   C:\WINDOWS\system32\ddrawex.dll
ModLoad: 736d0000 7371b000   C:\WINDOWS\system32\DDRAW.dll
ModLoad: 73b30000 73b36000   C:\WINDOWS\system32\DCIMAN32.dll
(9ec.b8c): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=0a544010 ebx=00000002 ecx=001e9d01 edx=00000004 esi=0a54400c edi=0b05ff90
eip=087a66aa esp=038fe318 ebp=038fe31c iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00050202
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\WINDOWS\system32\Macromed\Flash\Flash32_17_0_0_169.ocx - 
Flash32_17_0_0_169!IAEModule_IAEKernel_UnloadModule+0x26325a:
087a66aa 660f7f4770      movdqa  xmmword ptr [edi+70h],xmm0 ds:0023:0b060000=????????????????????????????????
0:008> kb
ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
038fe31c 087a66f5 0a544010 10004000 77ef6f0a Flash32_17_0_0_169!IAEModule_IAEKernel_UnloadModule+0x26325a
038fe33c 087a6741 0a544010 00000000 10004004 Flash32_17_0_0_169!IAEModule_IAEKernel_UnloadModule+0x2632a5
038fe360 08037cba 0a54400c 00000000 10004008 Flash32_17_0_0_169!IAEModule_IAEKernel_UnloadModule+0x2632f1
038fe3a4 07fdc3c7 09519680 038fe3f8 00000000 Flash32_17_0_0_169+0x77cba
038fe430 07ffffff 07ffffff 07ffffff 07ffffff Flash32_17_0_0_169+0x1c3c7
038fe434 07ffffff 07ffffff 07ffffff 0966c158 Flash32_17_0_0_169+0x3ffff
038fe438 07ffffff 07ffffff 0966c158 fffffffe Flash32_17_0_0_169+0x3ffff
038fe43c 07ffffff 0966c158 fffffffe 04001000 Flash32_17_0_0_169+0x3ffff
038fe454 07fcb099 00000000 09551560 09521f40 Flash32_17_0_0_169+0x3ffff
038fe468 08248734 00000001 080eee1d 04001000 Flash32_17_0_0_169+0xb099
038fe470 080eee1d 04001000 00000000 00000004 Flash32_17_0_0_169!DllUnregisterServer+0xa47d0
038fe484 0822f7cc 09519620 038fe4d0 09519260 Flash32_17_0_0_169+0x12ee1d
00000000 00000000 00000000 00000000 00000000 Flash32_17_0_0_169!DllUnregisterServer+0x8b868



6 POC:
====

See attachment


7 About Alibaba Security Research Team:
=====================